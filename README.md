[Nomisma.org](http://nomisma.org) is a dataset of numismatic datasets. We provide them `voID.rdf`, which points to our RDF `princeton-nomisma.rdf` hosted here on GitHub. This script collects data from the PUL catalog, combines it with a CSV generated by the PUL Numismatics team, and generates an XML that follows Nomisma's ontology.

## Installation

Ruby 2.6.5

## Quick run

In order to execute the full process execute the following commands, though note that these processes can take as long as an hour.

```sh
thor nomisma_xml_generator:cli:scrape_catalog_list
thor nomisma_xml_generator:cli:scrape_catalog_detail
thor nomisma_xml_generator:cli:generate_xml
```

## CLI details

First collect all coin IDs from the catalog

```sh
Usage:
  thor nomisma_xml_generator:cli:scrape_catalog_list     # Collect all coin IDs from the catalog

Options:
  [--output-dir=OUTPUT_DIR]  # Path to output directory
                             # Default: data
```

Then collect coin details from the catalog. When the process may be interrupted (making thousands of requests, this is not unlikely), use the `--continue` flag to pick up where the scrape had left off.

```sh

Usage:
  thor nomisma_xml_generator:cli:scrape_catalog_detail   # Collect all coin details from catalog

Options:
  [--output-dir=OUTPUT_DIR]          # Path to output directory
                                     # Default: data/raw
  [--coin-list-path=COIN_LIST_PATH]  # Path to coin-list.txt generated by catalog list scraper
                                     # Default: data/coin-list.txt
  [--continue], [--no-continue]      # Should scraping continue from where it left off (was an error raised?)

```

Generate the XML.

```sh
Usage:
  thor nomisma_xml_generator:cli:generate_xml    # Parse the JSON data collected from the catalog and use it to generate XML

Options:
  [--json-dir=JSON_DIR]                # Path to the directory of raw JSON files
                                       # Default: data/raw
  [--output-dir=OUTPUT_DIR]            # Directory where princeton-nomisma.rdf will be written
                                       # Default: data
  [--mapper-csv-path=MAPPER_CSV_PATH]  # Path to CSV that maps IDs to their numismatic reference links
                                       # Default: nomisma-mapper.csv

```

## Notes

- The location of `princeton-nomisma.rdf` should not be changed unless `voID.rdf` is updated and given to Nomisma.
- If `princeton-nomisma.rdf` is updated with new data, Nomisma should be contacted to run another ingestion. Preferably, do not contact them more than once every month.
- The deprecated python script and it's setup are found in the `deprecated-python` directory
